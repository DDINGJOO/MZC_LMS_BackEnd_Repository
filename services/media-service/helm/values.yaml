replicaCount: 2

image:
  repository: lms/media-service
  tag: latest
  pullPolicy: IfNotPresent

# Nginx sidecar for static file serving
nginx:
  enabled: true
  image:
    repository: nginx
    tag: "1.25-alpine"
    pullPolicy: IfNotPresent
  port: 80
  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

service:
  type: ClusterIP
  port: 8080
  nginxPort: 80

# PersistentVolumeClaim for media storage
persistence:
  enabled: true
  storageClass: ""  # Use default storage class
  accessModes:
    - ReadWriteMany  # Required for multiple replicas to share the same storage
  size: 50Gi
  annotations: {}

resources:
  limits:
    cpu: 1000m
    memory: 1024Mi
  requests:
    cpu: 250m
    memory: 512Mi

env:
  SPRING_PROFILES_ACTIVE: kubernetes
  SERVER_PORT: "8080"
  MEDIA_STORAGE_PATH: /var/lms/media
  MEDIA_BASE_URL: http://cdn.lms.local/media
  MEDIA_TEMP_PATH: /tmp/lms/media

configMap:
  data:
    SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/lms_media?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
    SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092
    SPRING_REDIS_HOST: redis
    SPRING_REDIS_PORT: "6379"

secret:
  data:
    SPRING_DATASOURCE_USERNAME: lms_user
    SPRING_DATASOURCE_PASSWORD: lms_password

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
  hosts:
    - host: api.lms.local
      paths:
        - path: /api/v1/media
          pathType: Prefix
          servicePort: 8080
    - host: cdn.lms.local
      paths:
        - path: /media
          pathType: Prefix
          servicePort: 80

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5

nodeSelector: {}

tolerations: []

affinity: {}
